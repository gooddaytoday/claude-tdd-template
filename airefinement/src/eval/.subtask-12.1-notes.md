# Subtask 12.1 — Dataset Reader Module

**Task:** 12.1 (parent: 12 — Golden Dataset & Task Format)
**Status:** done
**Test type:** unit
**Phase:** DOCUMENTATION

## What was implemented

Module `src/eval/dataset-reader.ts` — Dataset Reader для Golden Dataset.

### Functions

#### `loadGoldenDataset(filePath: string): GoldenDatasetTask[]`
- Reads JSONL file via `readFileSync(filePath, 'utf-8')`
- Splits content by `\n`, filters empty/whitespace-only lines
- Iterates lines with 1-based line number tracking
- Each line: `JSON.parse()` → `GoldenDatasetTaskSchema.parse()`
- On JSON parse error: throws `CollectorError('Invalid JSON at line N: ...')`
- On schema validation error: throws `CollectorError('Invalid schema at line N')`
- On file read error: throws `CollectorError('Failed to read file: ...')`
- Returns `GoldenDatasetTask[]`

#### `filterByTestType(tasks, type): GoldenDatasetTask[]`
- `Array.filter` by `task.test_type === type`
- Type parameter: `'unit' | 'integration' | 'both'`

#### `filterByDifficulty(tasks, difficulty): GoldenDatasetTask[]`
- `Array.filter` by `task.difficulty === difficulty`
- Difficulty parameter: `'easy' | 'medium' | 'hard' | 'adversarial'`

## Key design decisions

1. **CollectorError pattern** — reuses `CollectorError` from `@/telemetry/collector.js`, consistent with `readTraceEvents()` in `telemetry/collector.ts`. Error wraps original cause as second argument.

2. **Line number tracking** — 1-based (`i + 1`), included in error messages for easy debugging of malformed JSONL files.

3. **Two-phase validation** — JSON parsing and Zod schema validation are in separate try/catch blocks to produce distinct error messages.

4. **GoldenDatasetTaskSchema** — imported from `@/telemetry/schemas.js`; schema and type defined there (not in this module).

5. **Synchronous I/O** — uses `readFileSync` (not async), appropriate for CLI/eval-runner context where the file must be fully loaded before processing.

## Modified files

| File | Phase | Role |
|------|-------|------|
| `tests/unit/eval/dataset-reader.test.ts` | RED | Unit tests (stub triggered fail) |
| `src/eval/dataset-reader.ts` | GREEN | Full implementation |

## Cross-module dependencies

- `@/telemetry/collector.js` — `CollectorError`
- `@/telemetry/schemas.js` — `GoldenDatasetTaskSchema`, `GoldenDatasetTask`

## For architecture review

- New module `src/eval/` created; no existing CLAUDE.md yet (to be created after last subtask 12.3)
- `GoldenDatasetTask` schema lives in `telemetry/schemas.ts` — consider whether it belongs in `eval/` long-term
- No circular dependencies; `eval/` depends on `telemetry/`, not vice versa
